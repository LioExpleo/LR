{% extends 'base.html' %}

{% block content %}
<form method="post" enctype="multipart/form-data">

    <!--
    {% for instTicketOther in tickets_other_user %}
        <p> tickets_other_user id : {{ instTicketOther.id }}</p>
    {% endfor %}
    -->

    <p> <h3>allReviews :  {{ allReviews }} </h3>  </p>
    <p> <h3>tickets_user :  {{ tickets_user }} </h3>  </p>
    <p> <h4>Liste des tickets dans le Review de l'utilisateur : listTicketInReviews_user :  {{ listTicketInReviews_user }} </h4>  </p>
    <p> <h4>Liste des tickets utilisateurs : listTicketInTicket_user :  {{ listTicketInTicket_user }} </h4>  </p>
    <p> <h4>Liste des tickets de l'utilisateur sans Review : listTicketWithoutReviews_user :  {{ listTicketWithoutReviews_user }} </h4>  </p>


    <p> la liste listTicketWithoutReviews_user, indique quel tickets seront à afficher sans Review </p>


{% for instance in tickets_and_reviews %} <!-- boucle 1 pour tester tous les Reviews et tickets -->
     {% for instReview in reviews_user %} <!-- boucle 1.1 pour tester tous les Reviews de l'utilisateur -->
        {% if instance.id == instReview.id %}
        <div class="cl_post_review">
            <p> Review : {{ instReview }} <h2/> REVIEW {{ instReview.id }} </h2> </p>
            <p>Vous avez publié une critique</p>
            <p> time created : {{ instReview.time_created }}</p>
            <p> ticket : {{ instReview.ticket.id }}</p>
            <p> rating : {{ instReview.rating }}</p>
            {% include "extrait/extr_rating_stars.html" with rating=instReview.rating %}
            <p> headline : {{ instReview.headline }}</p>
            <p> body : {{ instReview.body }}</p>
            <p> <h4> n° TICKET REVIEW : {{ instReview.ticket.id }}</p> </h4>

            <p> ------------------------Review------------------------------</p>
            {% for instTicketOther in tickets_other_user %}
            <!-- <p> TICKET AUTRE UTILISATEUR : {{ instTicketOther.id }}</p> -->

            <!-- si le ticket du review = le ticket de l'utilisateur, afficher les données de l'autre utilisateur
            à la suite-->
                {% if instReview.ticket.id == instTicketOther.id %}
                    <p> REVIEW avec TICKET AUTRE UTILISATEUR n° ticket : {{ instReview.ticket.id }}</p>
                    <p> <h4> instTicket.id :  {{ instTicketOther.id }} </h4>  </p>
                    <p> instTicket.user :  {{ instTicketOther.user }}   </p>
                    <p> Identifiant Unique : {{ instTicketOther.id }}</p>
                    <p> Titre Ticket : {{ instTicketOther.title }}</p>
                    <p> Description Ticket : {{ instTicketOther.title }}</p>

                    {% if instTicketOther.image.url is not None %}
                        <img src="{{ instTicketOther.image.url }}">
                    {% endif %}

                    <br>
                             <a href="{% url 'review_update' instReview.id %}">[Modifier Review]</a>
                            <br>
                            <a href="{% url 'review_delete' instReview.id %}">[Supprimer Review]</a>
                    <p> **************** FIN REVIEW + TICKET AVEC AUTRE UTILISATEUR CREATEUR DU TICKET ****************</p>
                    <p> ***********************************************************************************************</p>
                {% endif %}
             {% endfor %}

     <!-- Les critiques qui sont affichées en réponse au ticket de l'utilisateur lui-même doivent être
     listées séparément du ticket-->
             {% for instTicket in tickets_user %}
                     <!-- <p> instTicket.id : {{ instTicket.id }}</p>-->
                    {% if instReview.ticket.id == instTicket.id %}
                        <p> <h4>instTicket.id :  {{ instTicket.id }} </h4>  </p>
                        <p> instTicket.user :  {{ instTicket.user }}  </p>
                        <p> Identifiant Unique : {{ instTicket.id }}</p>
                        <p> Titre Ticket : {{ instTicket.title }}</p>
                        <p> Description Ticket : {{ instTicket.title }}</p>

                        {% if instTicket.image.url is not None %}
                            <img src="{{ instTicket.image.url }}">
                        {% endif %}
                    <br>
                    <a href="{% url 'ticket_update' instTicket.id %}">[Modifier ticket]</a>
                    <br>
                    <a href="{% url 'ticket_delete' instTicket.id %}">[Supprimer ticket]</a>
                <p> **************** FIN REVIEW + TICKET AVEC MEME UTILISATEUR EN CREATEUR DU TICKET ****************</p>
                <p> *************************************************************************************************</p>
                    {% endif %}
            {% endfor %}
            {% endif %}
        {% endfor %}

       {% for i in listTicketWithoutReviews_user %} <!-- boucle 1.2 pour tester tous les tickets sans Review user -->
              {% if instance.id == i %}
                 <p> instance.ID =  i , ticket de soi-même à afficher seul car pas de Review pour le ticket </p>

                {% for instTicket in tickets_user %} <!-- boucle 1.2.1 pour tester tous les tickets user -->
                    {% if instance.id == instTicket.id %}

                        <p> **************** debut du ticket sans Review ****************</p>
                        <p> <h4> instTicket.id : {{ instTicket.id }} </h4></p>
                        <p>{{ instTicket.time_created  }}</p>
                        <p> Titre {{ instTicket.title }}</p>
                        <p>{{ instTicket.description }}</p>
                        {% if instTicket.image.url is not None %}
                            <img src="{{ instTicket.image.url }}">
                        {% endif %}
                         <p> **************** fin du ticket sans Review ****************</p>
                    {% endif %}
                {% endfor %}
              {% endif %}
       {% endfor %}
</div>

{% endfor %}

</form>

{% endblock %}


